public class VideoSuggestionController {
    
    @AuraEnabled
    public static List<Map<String, String>> searchResults(String keyValue){
        System.debug(LoggingLevel.DEBUG, 'Search string from apex: ' +keyValue);
        
        Http http = new Http();
        
        HttpRequest request = new HttpRequest();
        //request.setBody();
        request.setHeader('Content-Type','application/json');
        request.setMethod('GET');
        request.setEndpoint('https://youtube.googleapis.com/youtube/v3/search?part=snippet&maxResults=5&channelId=UCUpquzY878NEaZm5bc7m2sQ&q='+keyValue+'&key='Add your API Token key here'');
        
        HttpResponse response = http.send(request);
        
        fromJSON body = (fromJSON)JSON.deserialize(response.getBody(), fromJSON.class);
        System.debug(LoggingLevel.debug, 'Body: '+body);
        
        List<Map<String, String>> superItemList = new List<Map<String, String>>();

        //Iterate the list for all the records returned from REST API
        for(integer i=0; i< body.items.size(); i++){
            superItemList.add(new Map<String, String>{
                'f1' => body.items[i].snippet.title,
                'f2' => body.items[i].snippet.description, 
                'f3' => body.items[i].snippet.thumbnails.medium.url,
                'f4' => body.items[i].snippet.publishedAt,
                'f5' => body.items[i].id.videoId
            });
        }
        return superItemList;
    }

    @AuraEnabled
    public static Boolean sendEmail(String videoId, String contactId){
        try {
            System.debug(LoggingLevel.debug, 'from Send Email method: ');
            System.debug(LoggingLevel.debug, 'from video Id: '+ videoId);
            System.debug(LoggingLevel.debug, 'from Send Contact Id: '+ contactId);

            Contact con = [SELECT Id, Email FROM Contact WHERE Id =:contactId LIMIT 1];

            String finalURL = 'https://www.youtube.com/watch?v=' + videoId;
            System.debug(LoggingLevel.debug, 'Video URL: '+ finalURL);

            Messaging.SingleEmailMessage mail = new Messaging.SingleEmailMessage();

            // Strings to hold the email addresses to which you are sending the email.
            String[] toAddresses = new String[] {con.Email}; 
            //String[] ccAddresses = new String[] {''};
            

            // Assign the addresses for the To and CC lists to the mail object.
            mail.setToAddresses(toAddresses);
            //mail.setCcAddresses(ccAddresses);
            mail.setSubject('Video Suggestion ');

            mail.setHtmlBody('Your Query has been viewed and please refer the suggested video that fulfill your query '+finalURL);

            // Send the email you have created.
            Messaging.sendEmail(new Messaging.SingleEmailMessage[] { mail });

            return true;

        } catch (Exception e) {
            throw new AuraHandledException(e.getMessage());
        }
    }
    
    //
    //Generated by AdminBooster
    //
    
    public class fromJSON{
        public String kind;	//youtube#searchListResponse
        public String etag;	//a-dbZ_tozVQGCHcHo3qP5QJRwYE
        public String nextPageToken;	//CAUQAA
        public String regionCode;	//IN
        public cls_pageInfo pageInfo;
        public cls_items[] items;
    }
    class cls_pageInfo {
        public Integer totalResults;	//167
        public Integer resultsPerPage;	//5
    }
    class cls_items {
        public String kind;	//youtube#searchResult
        public String etag;	//rEgFcCKC4MBjWuH58HETgKufM64
        public cls_id id;
        public cls_snippet snippet;
    }
    class cls_id {
        public String kind;	//youtube#video
        public String videoId;	//Oco8NddXMY4
    }
    class cls_snippet {
        public String publishedAt;	//2024-02-27T12:59:30Z
        public String channelId;	//UCUpquzY878NEaZm5bc7m2sQ
        public String title;	//Say Hello to Einstein Copilot &#124; Salesforce
        public String description;	//Empower every employee to do more with conversational AI for your CRM. Sales, service, commerce, and marketing teams can ...
        public cls_thumbnails thumbnails;
        public String channelTitle;	//Salesforce
        public String liveBroadcastContent;	//none
        public String publishTime;	//2024-02-27T12:59:30Z
    }
    class cls_thumbnails {
        public cls_default default_x;
        public cls_medium medium;
        public cls_high high;
    }
    class cls_default {
        public String url;	//https://i.ytimg.com/vi/Oco8NddXMY4/default.jpg
        public Integer width;	//120
        public Integer height;	//90
    }
    class cls_medium {
        public String url;	//https://i.ytimg.com/vi/Oco8NddXMY4/mqdefault.jpg
        public Integer width;	//320
        public Integer height;	//180
    }
    class cls_high {
        public String url;	//https://i.ytimg.com/vi/Oco8NddXMY4/hqdefault.jpg
        public Integer width;	//480
        public Integer height;	//360
    }
}
